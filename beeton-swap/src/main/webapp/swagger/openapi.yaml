openapi: 3.0.3
info:
  title: Beeton Swap API
  version: 1.1.0
  description: |
    REST API для обмена **jetton**-токенов через децентрализованный сервис **Beeton Swap** (роутинг через DeDust).
    Эндпоинт синхронный: возвращает результат отправки транзакции кошельком сервера.

    Примечание:
      - Направление сделки задаётся полем `direction: buy|sell`.
      - Тип маршрута задаётся полем `route: native|multi`.
servers:
  - url: http://localhost:8080/beeton-swap-api
    description: Локальный сервер разработки

tags:
  openapi: 3.0.3
  info:
    title: Beeton Swap API
    version: 1.1.0
    description: |
      REST API для обмена **jetton**-токенов через децентрализованный сервис **Beeton Swap** (роутинг через DeDust).
      Эндпоинт синхронный: возвращает результат отправки транзакции кошельком сервера.

      Примечание:
        - Направление сделки задаётся полем `direction: buy|sell`.
        - Тип маршрута задаётся полем `route: native|multi`.
  servers:
    - url: http://localhost:8080/beeton-swap-api
      description: Локальный сервер разработки

  tags:
    - name: Swap
      description: Операции обмена jetton↔jetton и jetton↔TON (native)

  paths:
    /swap/desust:
      post:
        operationId: createSwap
        summary: Совершить обмен (swap)
        description: |
          Выполняет обмен между **jettonA** и **jettonB** через DeDust:
          - `direction=buy` — получить **jettonB** за счёт продажи **jettonA**/TON;
          - `direction=sell` — продать **jettonA** за **jettonB**/TON.
          - `route=native` — роутинг через пул с native-активом (TON);
          - `route=multi` — многошаговый роутинг (например: A→TON→B).

          В текущей реализации сервер отправляет транзакцию своим кошельком.
        tags: [Swap]
        requestBody:
          required: true
          description: Параметры операции обмена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SwapRequest'
              examples:
                buy_via_native:
                  summary: Купить jettonA за TON (маршрут native)
                  value:
                    direction: buy
                    route: native
                    jettonA: "0:111122223333444455556666777788889999aaaabbbbccccddddeeeeffff0000"
                    jettonB: "0:9999888877776666555544443333222211110000ffffeeeeddddccccbbbbaaaa"
                    jettonAmount: "1000000000"
                    mnemonic: "flush wolf spring claim shy mouse vibrant unfold trend call sea kick mechanic syrup winner crumble fun celery group high uncover miss deputy social"
                sell_via_multi:
                  summary: Продать jettonA за jettonB через TON (маршрут multi)
                  value:
                    direction: sell
                    route: multi
                    jettonA: "0:111122223333444455556666777788889999aaaabbbbccccddddeeeeffff0000"
                    jettonB: "0:9999888877776666555544443333222211110000ffffeeeeddddccccbbbbaaaa"
                    jettonAmount: "2500000000"
                    mnemonic: "flush wolf spring claim shy mouse vibrant unfold trend call sea kick mechanic syrup winner crumble fun celery group high uncover miss deputy social"
        responses:
          '200':
            description: Успешно инициирован обмен (транзакция отправлена)
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/SwapSuccessResponse'
                examples:
                  ok:
                    value:
                        status: success
                        direction: buy
                        route: native
                        jettonA: "0:1111222233334444..."
                        jettonB: "0:9999888877776666..."
                        jettonAmount: "1000000000"
                        amountIn: "285000000"
                        amountOut: "26355686"
                        message: "Transaction sent successfully"
          '400':
            description: Ошибка запроса — отсутствуют или некорректны обязательные параметры
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
                examples:
                  missing_params:
                    value:
                      status: error
                      code: "BAD_REQUEST"
                      message: "Missing parameters: jettonA, jettonB, direction, route, jettonAmount"
          '422':
            description: Семантическая ошибка — параметры прошли синтаксис, но невалидны бизнес-логически
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
                examples:
                  invalid_route:
                    value:
                      status: error
                      code: "UNPROCESSABLE_ENTITY"
                      message: "Route 'native' недоступен для указанной пары активов"
          '500':
            description: Внутренняя ошибка сервера при формировании/отправке транзакции
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
                examples:
                  internal:
                    value:
                      status: error
                      code: "INTERNAL_ERROR"
                      message: "Unexpected server exception"

  components:
    schemas:
      AddressHex:
        type: string
        description: |
          Адрес jetton в формате `workchain:hash` (hex, 64 символа), например `0:abcd...`.
          Для обменов с **native** активом в `jettonB` можно передавать любое значение.
        example: "0:111122223333444455556666777788889999aaaabbbbccccddddeeeeffff0000"
        pattern: '^[0-9-]+:[0-9a-fA-F]{64}$'

      AmountAtomic:
        type: string
        description: Количество токенов в минимальных (атомарных) единицах
        example: "1000000000"
        pattern: '^[0-9]+$'

      Mnemonic:
        type: string
        description: |
          BIP-39 mnemonic phrase (space-separated words). This server expects a 24-word mnemonic by default.
        example: "flush wolf spring claim shy mouse vibrant unfold trend call sea kick mechanic syrup winner crumble fun celery group high uncover miss deputy social"

      SwapDirection:
        type: string
        description: Направление сделки
        enum: [buy, sell]
        example: buy

      SwapRoute:
        type: string
        description: Тип маршрута обмена
        enum: [native, multi]
        example: native

      SwapRequest:
        type: object
        required:
          - jettonA
          - jettonB
          - direction
          - route
          - jettonAmount
          - mnemonic
        properties:
          jettonA:
            $ref: '#/components/schemas/AddressHex'
            description: Адрес токена, который отдаётся при `sell` или покупается при `buy` (см. `route`)
          jettonB:
            $ref: '#/components/schemas/AddressHex'
            description: Адрес токена, который требуется получить. Для обмена с native можно передать любое значение.
          direction:
            $ref: '#/components/schemas/SwapDirection'
          route:
            $ref: '#/components/schemas/SwapRoute'
          jettonAmount:
            $ref: '#/components/schemas/AmountAtomic'
          mnemonic:
            $ref: '#/components/schemas/Mnemonic'
          swapType:
            type: string
            deprecated: true
            description: |
              **DEPRECATED.** Ранее использовалось вместо `route`.
              Если отправлено, сервер трактует его как `route`.

      SwapSuccessResponse:
        type: object
        required: [status, direction, route, jettonA, jettonB, jettonAmount, amountIn, amountOut, message]
        properties:
          status:
            type: string
            enum: [success]
            example: success
          direction:
            $ref: '#/components/schemas/SwapDirection'
          route:
            $ref: '#/components/schemas/SwapRoute'
          jettonA:
            $ref: '#/components/schemas/AddressHex'
          jettonB:
            $ref: '#/components/schemas/AddressHex'
          jettonAmount:
            $ref: '#/components/schemas/AmountAtomic'
          amountIn:
            $ref: '#/components/schemas/AmountAtomic'
          amountOut:
            $ref: '#/components/schemas/AmountAtomic'
          message:
            type: string
            example: "Transaction sent successfully"

      ErrorResponse:
        type: object
        required: [status, message]
        properties:
          status:
            type: string
            enum: [error]
            example: error
          code:
            type: string
            description: Короткий код ошибки
            example: BAD_REQUEST
          message:
            type: string
            description: Человеко-читаемое описание ошибки
            example: Missing parameters